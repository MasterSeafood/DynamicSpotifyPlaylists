<!DOCTYPE html>
<html>
    <head>
        <title>My Spotify Authorization Demo</title>
    </head>
    <body>
        
        <a href="/login">Login to Spotify</a>
        <h2 id = "song"></h2>
        <h2 id = "access"></h2>
        <h2 id = "refresh"></h2>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script>

            (function(){
                /**
                * Obtains parameters from the hash of the URL
                * @return Object
                */
                function getHashParams() {
                    var hashParams = {};
                    var e, r = /([^&;=]+)=?([^&;]*)/g,
                        q = window.location.hash.substring(1);
                    while ( e = r.exec(q)) {
                        hashParams[e[1]] = decodeURIComponent(e[2]);
                    }
                    return hashParams;
                }

                var params = getHashParams();
                var access_token = params.access_token,
                    refresh_token = params.refresh_token,
                    error = params.error;
                
                console.log("Hello");
                console.log("Access: " + access_token);
                console.log("Refresh: " + refresh_token);

                if(error){
                    alert('There was an error during authentication');
                }else{
                    if(access_token){
                        document.getElementById("access").textContent = access_token;
                        document.getElementById("refresh").textContent = refresh_token;

                        $.ajax({
                            url: 'https://api.spotify.com/v1/me/player',
                            headers: {
                                'Authorization' : 'Bearer ' + access_token
                            },
                            success : function(response){
                                document.getElementById("song").textContent = response.item.name;
                            }
                        })
                    } else{
                        document.getElementById("access").textContent = "";
                        document.getElementById("refresh").textContent = "";
                        document.getElementById("song").textContent = "";


                    }
                }





            })();
        </script>
    </body>

    

</html>